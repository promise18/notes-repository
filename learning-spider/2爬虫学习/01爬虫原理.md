## 什么是爬虫？

请求网站并提取数据的自动化程序。（一段程序）

## 爬虫基本流程

1. **发起请求**：通过HTTP库向⽬标站点发起请求，即发送⼀个Request，请求可以包含额外的headers等信息，等待服务器响应。 
2. **获取响应内容 **:如果服务器能正常响应，会得到⼀个Response，Response的内容便是所要获取的⻚⾯内容，类型可能有HTML， Json字符串，⼆进制数据（如图⽚视频）等类型。 
3. **解析内容**：得到的内容可能是HTML，可以⽤正则表达式、⽹⻚解析库进⾏解析。可能是Json，可以直接转为Json对象解析，可能是⼆进制数据，可以做保存或者进⼀步的处理。 
4. **保存数据**：保存形式多样，可以存为⽂本，也可以保存⾄数据库，或者保存特定格式的⽂件。 

附：**开发爬虫的步骤：**

1. 目标数据
   - 网站
   - 页面
2. 分析数据加载流程
   - 分析目标数据所对应的的url
3. 下载数据
4. 清洗数据

## Request和Response

![1562375623100](D:\笔记\爬虫\2爬虫学习\01爬虫原理.assets\1562375623100.png)

### Request

Request包含：

**请求⽅式：主要有GET、 POST两种类型，另外还有HEAD、 PUT、 DELETE、 OPTIONS等。**

GET和POST的区别就是：请求的数据GET是在url中，POST则是存放在头部

GET:向指定的资源发出“显示”请求。使用GET方法应该只用在读取数据，而不应当被用于产生“副作用”的操作中，例如在Web Application中。其中一个原因是GET可能会被网络蜘蛛等随意访问。

POST:向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求本文中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。

HEAD：与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信息或称元数据）。

PUT：向指定资源位置上传其最新内容。

OPTIONS：这个方法可使服务器传回该资源所支持的所有HTTP请求方法。用'*'来代替资源名称，向Web服务器发送OPTIONS请求，可以测试服务器功能是否正常运作。

DELETE：请求服务器删除Request-URI所标识的资源。

**请求URL ：URL全称统⼀资源定位符，如⼀个⽹⻚⽂档、张图⽚、⼀个视频等都可以⽤URL唯⼀来确定。**

URL的格式由三个部分组成：
第一部分是协议(或称为服务方式)。
第二部分是存有该资源的主机IP地址(有时也包括端口号)。
第三部分是主机资源的具体地址，如目录和文件名等。

爬虫爬取数据时必须要有一个目标的URL才可以获取数据，因此，它是爬虫获取数据的基本依据。

**请求头：包含请求时的头部信息，如User-Agent、 Host、Cookies等信息 。**

**请求体 ：请求时额外携带的数据如表单提交时的表单数据 。（post）**

### Response 

Response包含：

**响应状态：有多种响应状态，如200代表成功、 301跳转、 404找不到⻚⾯、 502服务器错误 。**

- 1xx消息——请求已被服务器接收，继续处理
- 2xx成功——请求已成功被服务器接收、理解、并接受
- 3xx重定向——需要后续操作才能完成这一请求
- 4xx请求错误——请求含有词法错误或者无法被执行
- 5xx服务器错误——服务器在处理某个正确请求时发生错误 常见代码： 200 OK 请求成功 400 Bad Request 客户端请求有语法错误，不能被服务器所理解 401 Unauthorized 请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用 403 Forbidden 服务器收到请求，但是拒绝提供服务 404 Not Found 请求资源不存在，eg：输入了错误的URL 500 Internal Server Error 服务器发生不可预期的错误 503 Server Unavailable 服务器当前不能处理客户端的请求，一段时间后可能恢复正常 301 目标永久性转移 302 目标暂时性转移

**响应头：如内容类型、内容⻓度、服务器信息、设置Cookie等等。** 

**响应体：最主要的部分，包含了请求资源的内容，如⽹⻚HTML、图⽚⼆进制数据等。** 

## 能爬取什么样的数据

网页文本：如HTML文档，Json格式化文本等
图片：获取到的是二进制文件，保存为图片格式
视频:同样是二进制文件
其他：只要请求到的，都可以获取

## 如何解析数据

1. 直接处理
2. Json解析
3. 正则表达式处理
4. BeautifulSoup解析处理
5. PyQuery解析处理
6. XPath解析处理

## 关于抓取的页面数据和浏览器里看到的不一样的问题

出现这种情况是因为，很多网站中的数据都是通过js，ajax动态加载的，所以直接通过get请求获取的页面和浏览器显示的不同。

如何解决js渲染的问题？

1. 分析ajax
2. Selenium/webdriver
3. Splash
4. PyV8,Ghost.py

## 怎样保存数据

文本：纯文本，Json,Xml等

关系型数据库：如mysql,oracle,sql server等结构化数据库

非关系型数据库：MongoDB,Redis等key-value形式存储