## 1 时间上下文信息

### 1.1 时间效应简介

时间信息对用户兴趣的影响表现在以下几个方面。

1. 用户兴趣是变化的
2. 物品也是有生命周期的
3. 季节效应

### 1.2 时间上下文推荐算法

包含时间信息的用户行为数据集由一系列三元组构成，其中每个三元组(u,i,t)代表了用户u在时刻t对物品i产生过行为。 

#### 1.2.1 最近最热门

在没有时间信息的数据集中，我们可以给用户推荐历史上最热门的物品。那么在获得用户行为的时间信息后，最简单的非个性化推荐算法就是给用户推荐最近最热门的物品了。给定时间T，物品i最近的流行度 n~i~(T)可以定义为：

![1560907549926](D:\笔记\推荐系统\05-利用上下文信息.assets\1560907549926.png)

$\alpha$是时间衰减参数。

### 1.2.2 时间上下文相关的ItemCF算法

基于物品（item-based）的个性化推荐算法是商用推荐系统中应用最广泛的，该算法由两个核心部分构成： 

1. 利用用户行为离线计算物品之间的相似度； 
2. 根据用户的历史行为和物品相似度矩阵，给用户做在线个性化推荐。 

 时间信息在上面两个核心部分中都有重要的应用，这体现在两种时间效应上。 

1. 物品相似度 用户在相隔很短的时间内喜欢的物品具有更高相似度。 
2. 在线推荐 用户近期行为相比用户很久之前的行为，更能体现用户现在的兴趣。 

首先回顾一下前面提到的基于物品的协同过滤算法，它通过如下公式计算物品的相似度： 

![1560912595955](D:\笔记\推荐系统\05-利用上下文信息.assets\1560912595955.png)

而在给用户u做推荐时，用户u对物品i的兴趣p(u,i)通过如下公式计算： 

![1560912865913](D:\笔记\推荐系统\05-利用上下文信息.assets\1560912865913.png)

在得到时间信息（用户对物品产生行为的时间）后， 我们可以通过如下公式改进相似度计算： 

![1560912880539](D:\笔记\推荐系统\05-利用上下文信息.assets\1560912880539.png)

上面的公式在分子中引入了和时间有关的衰减项$f(|t~ui~-t~uj~|)$ ,其中t~ui~是用户u对物品i 产生行为的时间。f函数的含义是，用户对物品i和物品j产生行为的时间越远，则$f(|t~ui~-t~uj~|)$越小。我们可以找到很多数学衰减函数，本节使用如下衰减函数： 

![1560913009473](D:\笔记\推荐系统\05-利用上下文信息.assets\1560913009473.png)

$\alpha$是时间衰减参数，它的取值在不同系统中不同。如果一个系统用户兴趣变化很快，就应该取比较大的$\alpha$，反之需要取比较小的$\alpha$。 

除了考虑时间信息对相关表的影响，我们也应该考虑时间信息对预测公式的影响。一般来说，用户现在的行为应该和用户最近的行为关系更大。因此，我们可以通过如下方式修正预测公式： 

![1560913190877](D:\笔记\推荐系统\05-利用上下文信息.assets\1560913190877.png)

t~0~是当前时间。上面的公式表明， tuj 越靠近 t~0~ ，和物品j相似的物品就会在用户u的推荐列表中获得越高的排名。 $\beta$是时间衰减参数，需要根据不同的数据集选择合适的值。 

### 1.2.3 时间上下文相关的UserCF算法

UserCF的基本思想算法思想：给用户推荐和他兴趣相似的其他用户喜欢的物品。我们可以在以下两个方面利用时间信息改进UserCF算法：

1. 用户兴趣相似度 
2. 相似兴趣用户的最近行为 

UserCF通过如下公式计算用户u和用户v的兴趣相似度 :

![1561123571131](D:\笔记\推荐系统\05-利用上下文信息.assets\1561123571131.png)

其中N(u)是用户u喜欢的物品集合， N(v)是用户v喜欢的物品集合。可以利用如下方式考虑时间信息： 

![1561123899720](D:\笔记\推荐系统\05-利用上下文信息.assets\1561123899720.png)

上面公式的分子对于用户u和用户v共同喜欢的物品i增加了一个时间衰减因子。用户u和用户v对物品i产生行为的时间越远，那么这两个用户的兴趣相似度就会越小。 

在得到用户相似度后， UserCF通过如下公式预测用户对物品的兴趣： 

![1561123967296](D:\笔记\推荐系统\05-利用上下文信息.assets\1561123967296.png)

其中， S(u,K)包含了和用户u兴趣最接近的K个用户。如果用户v对物品i产生过行为，那么rui=1，否则 rui=0 。 

如果考虑和用户u兴趣相似用户的最近兴趣，我们可以设计如下公式： 

![1561124076360](D:\笔记\推荐系统\05-利用上下文信息.assets\1561124076360.png)

### 1.2.4 时间段图模型

时间段图模型看着比较复杂，先举个例子：

![1561124661351](D:\笔记\推荐系统\05-利用上下文信息.assets\1561124661351.png)

用户A在时刻2对物品b产生了行为。因此，时间段图模型会首先创建4个顶点，即用户顶点A、用户时间段顶点A:2、物品顶点b、物品时间段顶点b:2。然后，图中会增加3条边，即(A, b)、 (A:2, b)、 (A, b:2)。这里不再增加(A:2, b:2)这条边，一方面是因为增加这条边后不会对结果有所改进，另一方面则是因为增加一条边会增加图的空间复杂度和图上算法的时间复杂度。 

使用**路径融合算法**来度量图上两个顶点的相关性。图上两个相关性比较高的顶点一般具有如下特征：

1. 两个顶点之间有很多路径
2. 两个顶点之前的路径比较短
3. 两个顶点之间的路径不经过出度比较大的顶点。 

从这3条原则出发，路径融合算法首先提取出两个顶点之间长度小于一个阈值的所有路径，然后根据每条路径经过的顶点给每条路径赋予一定的权重，最后将两个顶点之间所有路径的权重之和作为两个顶点的相关度。 

## 2 地点上下文

除了时间，地点作为一种重要的空间特征，也是一种重要的上下文信息。不同地区的用户兴趣有所不同，用户到了不同的地方，兴趣也会有所不同。 

### 2.1 基于位置的推荐算法

用户兴趣和地点相关的两种特征：

1. 兴趣本地化：不同地方的用户兴趣存在着很大的差别
2. 活动本地化：一个用户往往在附近的地区活动

